<!DOCTYPE html>
<html lang="en">
<head>
    <link rel="stylesheet" href="../static/css/style.css">
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard</title>
</head>
<body>
    <h1 id="title">College Revenues and the Geography of Sports</h1>
    <h3 id="attribution">By Ed Bowen and Ean Maloney</h3>
    
    <h2>Use the search feature below to see the nearest NBA and MLB teams to a school (distances are in miles).</h2>
    <!-- https://stackoverflow.com/questions/52644035/how-to-show-a-pandas-dataframe-into-a-existing-flask-html-table -->
    {% for table in tables %} 
        {{table|safe}}
    {% endfor %}
   
    <!-- adapted from: ttps://www.geeksforgeeks.org/retrieving-html-from-data-using-flask/ -->
    <form action="{{url_for("home")}}" method="post">
        <input type="text" id="school_name" name="school_name" placeholder="Search for schools.">
        <button type="submit">Search</button>

    <!-- Markdown Report -->
    <div>
        <h2 id="topic">Topic</h2>
        <p>The question we are seeking to answer is whether proximity to a professional baseball or basketball venue has any effect on the revenues of college athletics programs with regard to those sports. This topic was chosen becasue the data were readily available and the question was of personal interest to our team.</p>
        <p>To aid in our analysis we divided the continental US into the following regions, based on the <a href = "https://www.ncdc.noaa.gov/monitoring-references/maps/us-census-divisions.php">US Census Divisions</a>. The graphic below also shows the locations of MLB and NBA stadiums.</p>
        <!-- Map  -->
        <div class='tableauPlaceholder' id='viz1631910294692' style='position: relative'><noscript><a href='#'><img alt='Teams and Regions ' src='https:&#47;&#47;public.tableau.com&#47;static&#47;images&#47;fi&#47;final_project_geo&#47;teams_regions&#47;1_rss.png' style='border: none' /></a></noscript><object class='tableauViz'  style='display:none;'><param name='host_url' value='https%3A%2F%2Fpublic.tableau.com%2F' /> <param name='embed_code_version' value='3' /> <param name='site_root' value='' /><param name='name' value='final_project_geo&#47;teams_regions' /><param name='tabs' value='no' /><param name='toolbar' value='yes' /><param name='static_image' value='https:&#47;&#47;public.tableau.com&#47;static&#47;images&#47;fi&#47;final_project_geo&#47;teams_regions&#47;1.png' /> <param name='animate_transition' value='yes' /><param name='display_static_image' value='yes' /><param name='display_spinner' value='yes' /><param name='display_overlay' value='yes' /><param name='display_count' value='yes' /><param name='language' value='en-US' /><param name='filter' value='publish=yes' /></object></div>                <script type='text/javascript'>                    var divElement = document.getElementById('viz1631910294692');                    var vizElement = divElement.getElementsByTagName('object')[0];                    vizElement.style.width='100%';vizElement.style.height=(divElement.offsetWidth*0.75)+'px';                    var scriptElement = document.createElement('script');                    scriptElement.src = 'https://public.tableau.com/javascripts/api/viz_v1.js';                    vizElement.parentNode.insertBefore(scriptElement, vizElement);                </script>
        <h2 id="data-sources">Data Sources</h2>
        <ul>
        <li>College and financial data from Equity in Athletics Data Analysis (EADA).</li>
        <li>MLB teams/stadiums from <strong><a href="https://appac.github.io/mlb-data-api-docs/#team-data-list-teams-get">https://appac.github.io/mlb-data-api-docs/#team-data-list-teams-get</a></strong></li>
        <li>NBA teams/stadiums from <strong><a href="https://en.wikipedia.org/wiki/National_Basketball_Association">https://en.wikipedia.org/wiki/National_Basketball_Association</a></strong></li>
        <li>Geographical coordinates via Wikimedia API.</li>
        <li>Distances to nearest professional stadiums computed using coordinates for stadiums and schools.</li>
        </ul>
        <h1 id="data-exploration">Data Exploration</h1>
        <p>Our dataset consists of information from 1,808 colleges and universities whose pages were geotagged on Wikipedia. The original EADA table contained 2,074 schools, so approximately 13% of the data was lost because coordinates for the school could not be found through Wikimedia's API. We hypothesize that these schools without geotagged Wikipedia pages are mostly small colleges. Three additional schools were dropped because they shared names with schools outside the United States and were therefore mislocated by the API.</p>
        <p>We hypothesize that most of the schools that had to be dropped were relatively small. Thus, the loss of these data points is not especially significant for our project, since we are more interested in the revenues of larger schools, and because it seems evident that smaller schools will have lower revenues in virtue of a smaller student/alumni base, bracketing all other factors.</p>
        <p>Exploratory data analysis revealed no correlation between distance from professional teams and revenues for the whole dataset, but notable levels of correlation when the schools are grouped by region. This suggests that the region in which a college is located may be significant factor in determining the revenues for basketball and baseball at that school.</p>
        <h2 id ="scatters">Charting All Datapoints</h2>
        <p>The following scatterplots show that there is little noticeable correlation between revenue and distance to professional venues for either of the sports examined when we look at all the schools included in our dataset.</p>
        <!-- basketball scatter -->
        <div class='tableauPlaceholder' id='viz1632154281071' style='position: relative'><noscript><a href='#'><img alt='Basketball Revenue vs. Distance to NBA Team ' src='https:&#47;&#47;public.tableau.com&#47;static&#47;images&#47;fi&#47;final_project_16315811682960&#47;dist_scatter_basketball&#47;1_rss.png' style='border: none' /></a></noscript><object class='tableauViz'  style='display:none;'><param name='host_url' value='https%3A%2F%2Fpublic.tableau.com%2F' /> <param name='embed_code_version' value='3' /> <param name='site_root' value='' /><param name='name' value='final_project_16315811682960&#47;dist_scatter_basketball' /><param name='tabs' value='no' /><param name='toolbar' value='yes' /><param name='static_image' value='https:&#47;&#47;public.tableau.com&#47;static&#47;images&#47;fi&#47;final_project_16315811682960&#47;dist_scatter_basketball&#47;1.png' /> <param name='animate_transition' value='yes' /><param name='display_static_image' value='yes' /><param name='display_spinner' value='yes' /><param name='display_overlay' value='yes' /><param name='display_count' value='yes' /><param name='language' value='en-US' /><param name='filter' value='publish=yes' /></object></div>                <script type='text/javascript'>                    var divElement = document.getElementById('viz1632154281071');                    var vizElement = divElement.getElementsByTagName('object')[0];                    vizElement.style.width='100%';vizElement.style.height=(divElement.offsetWidth*0.75)+'px';                    var scriptElement = document.createElement('script');                    scriptElement.src = 'https://public.tableau.com/javascripts/api/viz_v1.js';                    vizElement.parentNode.insertBefore(scriptElement, vizElement);                </script>
        <!-- baseball scatter -->
        <div class='tableauPlaceholder' id='viz1632154496590' style='position: relative'><noscript><a href='#'><img alt='Baseball Revenue vs. Distance to MLB Team ' src='https:&#47;&#47;public.tableau.com&#47;static&#47;images&#47;fi&#47;final_project_16315811682960&#47;dist_scatter_baseball&#47;1_rss.png' style='border: none' /></a></noscript><object class='tableauViz'  style='display:none;'><param name='host_url' value='https%3A%2F%2Fpublic.tableau.com%2F' /> <param name='embed_code_version' value='3' /> <param name='site_root' value='' /><param name='name' value='final_project_16315811682960&#47;dist_scatter_baseball' /><param name='tabs' value='no' /><param name='toolbar' value='yes' /><param name='static_image' value='https:&#47;&#47;public.tableau.com&#47;static&#47;images&#47;fi&#47;final_project_16315811682960&#47;dist_scatter_baseball&#47;1.png' /> <param name='animate_transition' value='yes' /><param name='display_static_image' value='yes' /><param name='display_spinner' value='yes' /><param name='display_overlay' value='yes' /><param name='display_count' value='yes' /><param name='language' value='en-US' /><param name='filter' value='publish=yes' /></object></div>                <script type='text/javascript'>                    var divElement = document.getElementById('viz1632154496590');                    var vizElement = divElement.getElementsByTagName('object')[0];                    vizElement.style.width='100%';vizElement.style.height=(divElement.offsetWidth*0.75)+'px';                    var scriptElement = document.createElement('script');                    scriptElement.src = 'https://public.tableau.com/javascripts/api/viz_v1.js';                    vizElement.parentNode.insertBefore(scriptElement, vizElement);                </script>
        <h2 id = "group_region">Grouping by Region</h2>
        <p>However, grouping the datapoints by region reveals that regions where the average distance to a professional venue is greater tend to have higher median revenues.</p>
        <!-- basketball group -->
        <div class='tableauPlaceholder' id='viz1632154724780' style='position: relative'><noscript><a href='#'><img alt='Basketball Revenue by Region ' src='https:&#47;&#47;public.tableau.com&#47;static&#47;images&#47;fi&#47;final_project_16315811682960&#47;group_by_region_basketball&#47;1_rss.png' style='border: none' /></a></noscript><object class='tableauViz'  style='display:none;'><param name='host_url' value='https%3A%2F%2Fpublic.tableau.com%2F' /> <param name='embed_code_version' value='3' /> <param name='site_root' value='' /><param name='name' value='final_project_16315811682960&#47;group_by_region_basketball' /><param name='tabs' value='no' /><param name='toolbar' value='yes' /><param name='static_image' value='https:&#47;&#47;public.tableau.com&#47;static&#47;images&#47;fi&#47;final_project_16315811682960&#47;group_by_region_basketball&#47;1.png' /> <param name='animate_transition' value='yes' /><param name='display_static_image' value='yes' /><param name='display_spinner' value='yes' /><param name='display_overlay' value='yes' /><param name='display_count' value='yes' /><param name='language' value='en-US' /><param name='filter' value='publish=yes' /></object></div>                <script type='text/javascript'>                    var divElement = document.getElementById('viz1632154724780');                    var vizElement = divElement.getElementsByTagName('object')[0];                    vizElement.style.width='100%';vizElement.style.height=(divElement.offsetWidth*0.75)+'px';                    var scriptElement = document.createElement('script');                    scriptElement.src = 'https://public.tableau.com/javascripts/api/viz_v1.js';                    vizElement.parentNode.insertBefore(scriptElement, vizElement);                </script>
        <!-- baseball group -->
        <div class='tableauPlaceholder' id='viz1632154762542' style='position: relative'><noscript><a href='#'><img alt='Baseball Revenue by Region ' src='https:&#47;&#47;public.tableau.com&#47;static&#47;images&#47;fi&#47;final_project_16315811682960&#47;group_by_region_baseball&#47;1_rss.png' style='border: none' /></a></noscript><object class='tableauViz'  style='display:none;'><param name='host_url' value='https%3A%2F%2Fpublic.tableau.com%2F' /> <param name='embed_code_version' value='3' /> <param name='site_root' value='' /><param name='name' value='final_project_16315811682960&#47;group_by_region_baseball' /><param name='tabs' value='no' /><param name='toolbar' value='yes' /><param name='static_image' value='https:&#47;&#47;public.tableau.com&#47;static&#47;images&#47;fi&#47;final_project_16315811682960&#47;group_by_region_baseball&#47;1.png' /> <param name='animate_transition' value='yes' /><param name='display_static_image' value='yes' /><param name='display_spinner' value='yes' /><param name='display_overlay' value='yes' /><param name='display_count' value='yes' /><param name='language' value='en-US' /><param name='filter' value='publish=yes' /></object></div>                <script type='text/javascript'>                    var divElement = document.getElementById('viz1632154762542');                    var vizElement = divElement.getElementsByTagName('object')[0];                    vizElement.style.width='100%';vizElement.style.height=(divElement.offsetWidth*0.75)+'px';                    var scriptElement = document.createElement('script');                    scriptElement.src = 'https://public.tableau.com/javascripts/api/viz_v1.js';                    vizElement.parentNode.insertBefore(scriptElement, vizElement);                </script>
        <h1 id="machine-learning">Machine Learning</h1>
        <h2 id="overview">Overview</h2>
        <p>We attempted to apply several machine learning algotithms to out data to develop models of the correlation between distance from professional stadiums and other relevant factors and the revenues of college programs. Multiple linear regression, random forest regression, and AdaBoost methods were all unsuccessful at correlating the input factors to revenues in either sport. Possible reasons for this lack of success are the relatively small number of data points (<2000 for either sport) and the shape of the overall distribution (which I hypothesize to be bimodal with a split betwee high-revenue schools and a larger number of low-revenue schools).</p>
        <h2 id="data-preprocessing-and-feature-selection">Data Preprocessing and Feature Selection</h2>
        <p>The data input for our machine learning model was a combination of the columns from our school_geo and eada tables that we determined were relevant for the model. The features deemed relevant were:</p>
        <ol>
        <li>Size of student body.</li>
        <li>Revenue for baseball/men's basketball.</li>
        <li>Region in which school is located.</li>
        <li>Whether the school is in NCAA Div. I or not.</li>
        <li>Whether the school is public or private, for-profit or non-profit, 2 year or 4 year.</li>
        <li>Distance to nearest MLB/NBA stadium.</li>
        </ol>
        <p>These features were selected because they were available or derivable from the EADA dataset and seemed most likely to contribute to sports revenues.</p>
        <p>We examined the baseball and basketball data seperately, so information related particularly to each sport was not included in the machine learning model of the other. When schools did not have  revenues reported for the sport being considered, their data was dropped prior to machine learning analysis. Thus, 1,418 schools were included in the baseball model and 1,647 schools in the basketball model.</p>
        <p>Additionally all schools whose region was &quot;Other,&quot; i.e., was not in the continental United States, was dropped from the dataset. These schools were outliers in the context of our analysis in light of their being geographically or culturally separated from the continental US.</p>
        <h2 id="model-setup">Model Setup</h2>
        <p>Prior to running machine learning algorithms, categorical features were converted to binary variables using Scikit Learn's OneHotEncoder method. The revenue for baseball/basketball was then isolated from the rest of the data as the target vaviable, and the data was split into training and testing sets using the train_test_split method. Finally all features were scaled using the StandardScaler method, which transforms the values for each feature to the Z-scores for the distribution of that feature in the training data.</p>
        <h2 id="application-of-machine-learning-methods">Application of Machine Learning Methods</h2>
        <p>We decided to analyze the data with three different machine learning methods: multiple linear regression (MLR), random forest regression (RFR), and AdaBoost regression (ABR).</p>
        <p>The benefit of MLR is that it is the simplest model to understand and returns coefficients representing the magnitudes and directions of the relations between each feature and the dependent variable (revenue).</p>
        <p>RFR and ABR are more complex ensemble methods. RFR combines multiple decision tree models to produce an aggregate model. ABR creates several models over a series of iterations, where in each iteration it attempts to correct the bad predictions of the previous iteration. These models are therefore have capabilities to produce more finely-tuned models than MLR.</p>
        <h2 id="results-of-machine-learning-methods">Results of Machine Learning Methods</h2>
        <p>All three models performed poorly for baseball revenues, and none achieved an r2-score of greater than .2.</p>
        <p>All models were more successful with basketball revenues, but both were still only able to achieve r2-scores between .2 and .5.</p>
        <h1 id = "conclusions">Conclusions</h1>
        <ul>
            <li>No correlation between distance from professional teams and revenues for the whole dataset</li>
            <li>Notable levels of correlation when the schools are grouped by region suggesting it may be significant factor in determining the revenues for basketball and baseball at a college</li>
        </ul>
    </div> 
</body>
</html>